#!/bin/sh

# CLI script is a inferface to executes commands on the CLI service.
# The CLI service contains a set of commands to manage users, namesapces and members.

exit_with_error() {
    echo "ERROR: ShellHub is not running. Exiting."
    exit 1
}

. "$(dirname "$0")/utils"

cd $(dirname $(readlink_f $0))/../

DOCKER_COMPOSE=$(evaluate_docker_compose)

# Disable "exit on error" for service check
set +e

SERVICES=$($DOCKER_COMPOSE ps -q | grep -v INFO: | xargs docker inspect -f '{{.State.Running}}' 2>/dev/null | grep -c 'true')

# Re-enable "exit on error" after service check
set -e

[ ! "$SERVICES" -gt 0 ] && exit_with_error

exec $DOCKER_COMPOSE exec cli ./cli $@
